<!doctype html>
<html lang="pt">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Entre Mundos ‚Äî Dia 1</title>

  <style>
    :root{
      --bg:#0b2238; --card:#112c4a; --card-edge:#1a3a5a;
      --text:#e8f0fb; --muted:#a9bed9; --accent:#ffd85b;
      --btn:#214f85; --btn-text:#ffffff; --btn-soft:#173a63;
      --shadow:0 10px 24px rgba(0,0,0,.35); --radius:20px;
    }
    html,body{margin:0;background:radial-gradient(1200px 600px at 50% -100px,#173455 0%,#0b2238 60%,#07192b 100%);color:var(--text);font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;line-height:1.5}
    .wrap{max-width:860px;margin:24px auto;padding:0 16px}
    header{display:flex;align-items:center;gap:12px;margin:8px 0 14px}
    header .dot{width:26px;height:26px;border-radius:8px;background:radial-gradient(circle at 30% 30%,#3ea7ff,#0e4379 60%,#0a2a4a);box-shadow:inset 0 0 0 2px rgba(255,255,255,.08)}
    h1{font-size:32px;margin:0 0 10px}
    nav{display:flex;gap:14px;flex-wrap:wrap;margin:0 0 14px}
    .chip{padding:10px 16px;border-radius:16px;background:rgba(255,255,255,.06);color:var(--muted);backdrop-filter:blur(6px);-webkit-backdrop-filter:blur(6px);border:1px solid rgba(255,255,255,.07);cursor:pointer}
    .chip.active{color:#fff;background:rgba(255,255,255,.12)}
    .card{background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));border:1px solid var(--card-edge);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px 18px;margin:16px 0}
    .card h2{margin:0 0 10px;font-size:18px;color:var(--muted);font-weight:600}
    .highlight{color:var(--accent);font-weight:700}
    #oracleMsg{font-size:22px;margin:12px 0 16px;color:var(--text)}
    .row{display:flex;gap:12px;flex-wrap:wrap}
    button{appearance:none;border:0;border-radius:14px;padding:12px 18px;background:var(--btn);color:var(--btn-text);font-weight:700;box-shadow:0 6px 14px rgba(13,86,164,.35);cursor:pointer}
    button.secondary{background:var(--btn-soft)}
    .note{color:var(--muted);font-size:14px;margin-top:8px}
    .fav-empty{color:var(--muted);font-style:italic}
    .fav-item{display:flex;justify-content:space-between;gap:12px;padding:10px 0;border-bottom:1px solid rgba(255,255,255,.08)}
    .fav-text{flex:1}
    .muted-link{color:var(--muted);text-decoration:underline;cursor:pointer}
    footer{color:var(--muted);text-align:center;margin:22px 0}
  </style>

  <!-- S√≥ o Or√°culo (frases). N√£o carregar tabs-hotfix.js para evitar conflito -->
  <script src="oraculo.js?v=9" defer></script>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="dot"></div>
      <h1>Entre Mundos ‚Äî Dia 1</h1>
    </header>

    <nav>
      <div class="chip" data-tab="tabMensagem">Mensagem</div>
      <div class="chip" data-tab="tabRespiracao">Respira√ß√£o</div>
      <div class="chip" data-tab="tabFrase">Frase</div>
      <div class="chip" data-tab="tabSilencio">Sil√™ncio</div>
      <div class="chip" data-tab="tabFavoritos">Favoritos</div>
    </nav>

    <!-- Mensagem -->
    <section class="card" id="tabMensagem">
      <h2>Mensagem de hoje ‚Äî <span class="highlight">Reconex√£o</span></h2>
      <p>Respira e lembra-te: <strong>tu √©s a casa antes do mundo.</strong> O teu valor n√£o depende da produtividade; a tua verdade n√£o precisa gritar. A cor azul √© o teu porto ‚Äî volta a ela quando o ru√≠do te cansar.</p>
    </section>

    <!-- Respira√ß√£o -->
    <section class="card" id="tabRespiracao" style="display:none">
      <h2>Exerc√≠cio de Respira√ß√£o</h2>
      <p>Inspira 4, segura 4, expira 6. Repete 5 vezes.</p>
    </section>

    <!-- Frase -->
    <section class="card" id="tabFrase" style="display:none">
      <h2>Frase Inspiradora</h2>
      <p>"Mesmo no escuro, a tua luz interior sabe o caminho."</p>
    </section>

    <!-- Sil√™ncio -->
    <section class="card" id="tabSilencio" style="display:none">
      <h2>Pr√°tica de Sil√™ncio</h2>
      <p>Fecha os olhos, escuta a respira√ß√£o e deixa o mundo desaparecer por 1 minuto.</p>
    </section>

    <!-- Or√°culo ‚Äî vis√≠vel em todas as abas excepto Sil√™ncio e Favoritos -->
    <section class="card" id="cardOraculo">
      <h2>Or√°culo ‚Äî Entre Mundos</h2>
      <div id="oracleMsg" aria-live="polite">Toca em <em>‚ÄúNova mensagem‚Äù</em> para receber a tua mensagem.</div>
      <div class="row">
        <button id="btnNova">Nova mensagem</button>
        <button id="btnCopiar" class="secondary">Copiar</button>
        <button id="btnWhats" class="secondary">Partilhar no WhatsApp</button>
        <button id="btnFav" title="Guardar esta frase nos favoritos">‚≠ê Guardar</button>
      </div>
      <p class="note">As frases surgem de forma aleat√≥ria e sem n√∫meros.</p>
    </section>

    <!-- Favoritos -->
    <section class="card" id="tabFavoritos" style="display:none">
      <h2>Favoritos</h2>
      <div id="favList"></div>
      <p class="note"><a id="btnClearAll" class="muted-link" href="javascript:void(0)">Limpar todos</a></p>
    </section>

    <footer>Entre Mundos ‚Äî feito com verdade üíô</footer>
  </div>

  <script>
    /* ===== Alternar abas e esconder/mostrar Or√°culo ===== */
    const HIDE_ORACULO_IN = new Set(['tabSilencio','tabFavoritos']);
    const ORACULO_ID = 'cardOraculo';

    document.querySelectorAll('.chip[data-tab]').forEach(chip => {
      chip.addEventListener('click', () => {
        // esconder tudo
        document.querySelectorAll('section.card').forEach(sec => sec.style.display = 'none');

        // mostrar aba pedida
        const tabId = chip.dataset.tab;
        const target = document.getElementById(tabId);
        if (target) target.style.display = 'block';

        // mostrar/esconder or√°culo
        const oraculo = document.getElementById(ORACULO_ID);
        if (oraculo) oraculo.style.display = HIDE_ORACULO_IN.has(tabId) ? 'none' : 'block';

        // estado visual dos chips
        document.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
        chip.classList.add('active');

        // quando entra nos Favoritos, renderiza lista
        if (tabId === 'tabFavoritos') renderFavs();
      });
    });

    // Estado inicial
    (function initTabs(){
      const defaultTab = 'tabMensagem';
      const first = document.querySelector(`.chip[data-tab="${defaultTab}"]`) || document.querySelector('.chip[data-tab]');
      if (first) first.click();
    })();

    /* ===== Or√°culo ‚Äì bot√µes padr√£o ===== */
    const elText   = document.getElementById('oracleMsg');
    const btnNova  = document.getElementById('btnNova');
    const btnCopiar= document.getElementById('btnCopiar');
    const btnWhats = document.getElementById('btnWhats');
    const btnFav   = document.getElementById('btnFav');

    function copiar(){
      const t=(elText.textContent||'').trim(); if(!t) return;
      if(navigator.clipboard?.writeText) navigator.clipboard.writeText(t).catch(()=>{});
      else { const ta=document.createElement('textarea'); ta.value=t; document.body.appendChild(ta); ta.select(); try{document.execCommand('copy');}catch{} ta.remove(); }
    }
    function whats(){
      const t = encodeURIComponent((elText.textContent||'').trim()); if(!t) return;
      location.href = 'https://wa.me/?text=' + t;
    }
    btnCopiar.addEventListener('click', copiar);
    btnWhats .addEventListener('click', whats);

    // a fun√ß√£o novaFrase √© criada em oraculo.js; se existir, liga o bot√£o:
    if (typeof window.novaFrase === 'function') {
      btnNova.addEventListener('click', window.novaFrase);
    }

    /* ===== Favoritos (localStorage) ===== */
    const LS_KEY = 'entreMundos.favs.v1';

    function getFavs(){ try{ return JSON.parse(localStorage.getItem(LS_KEY)||'[]'); }catch{ return []; } }
    function setFavs(arr){ localStorage.setItem(LS_KEY, JSON.stringify(arr.slice(0, 1000))); }
    function isFav(txt){ const t=(txt||'').trim(); return getFavs().some(x=>x===t); }

    function updateFavButtonState(){
      const t=(elText.textContent||'').trim();
      if(!t){ btnFav.disabled=true; btnFav.textContent='‚≠ê Guardar'; return; }
      btnFav.disabled=false;
      btnFav.textContent = isFav(t) ? '‚òÖ Guardado' : '‚≠ê Guardar';
    }

    function addFav(){
      const t=(elText.textContent||'').trim(); if(!t) return;
      const favs=getFavs();
      if(!favs.includes(t)){ favs.unshift(t); setFavs(favs); }
      updateFavButtonState(); renderFavs();
    }
    function removeFav(txt){
      setFavs(getFavs().filter(x=>x!==txt));
      renderFavs(); updateFavButtonState();
    }
    function clearAll(){
      if(confirm('Limpar todos os favoritos?')){ setFavs([]); renderFavs(); updateFavButtonState(); }
    }

    function escapeHtml(s){ return s.replace(/[&<>"]/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[m])); }
    function renderFavs(){
      const box=document.getElementById('favList');
      const favs=getFavs();
      if(!favs.length){
        box.innerHTML = '<p class="fav-empty">Ainda n√£o tens favoritos. Guarda frases com o bot√£o ‚≠ê no Or√°culo.</p>';
        return;
      }
      box.innerHTML = favs.map(t=>`
        <div class="fav-item">
          <div class="fav-text">${escapeHtml(t)}</div>
          <button class="secondary" data-rm="${encodeURIComponent(t)}">Remover</button>
        </div>`).join('');
      box.querySelectorAll('button[data-rm]').forEach(b=>{
        b.addEventListener('click', ()=> removeFav(decodeURIComponent(b.dataset.rm)));
      });
    }

    btnFav.addEventListener('click', ()=>{
      const t=(elText.textContent||'').trim(); if(!t) return;
      if(isFav(t)) return;
      addFav();
    });
    document.getElementById('btnClearAll').addEventListener('click', clearAll);

    // mensagem inicial
    if (!elText.textContent || /Nova mensagem/i.test(elText.textContent))
      elText.textContent = 'Toca em ‚ÄúNova mensagem‚Äù para receber a tua mensagem.';
    updateFavButtonState();

    // sempre que o or√°culo muda (nova frase), tenta atualizar estado do bot√£o
    // (se a tua oraculo.js expuser um evento, liga aqui; sen√£o, fica assim simples)
    if (btnNova) btnNova.addEventListener('click', updateFavButtonState);
  </script>
</body>
</html>
