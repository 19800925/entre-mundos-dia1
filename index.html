<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#0a1628">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="assets/icon-192.png?v=8">
  <title>Entre Mundos ‚Äî Dia 1</title>
  <style>
    :root { --bg:#0a1628; --fg:#e9f0ff; --muted:#9db3ff; --accent:#ffd250; --panel:#0f2342; --ring:#4a6fff; }
    html,body{margin:0;height:100%;font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial;color:var(--fg);background:radial-gradient(1200px 600px at 50% -10%,#123064,var(--bg));}
    .wrap{
      max-width:720px;margin:0 auto;padding:24px 16px;
      /* espa√ßo para o rodap√© + safe area */
      padding-bottom: calc(130px + env(safe-area-inset-bottom));
    }
    header{display:flex;gap:12px;align-items:center;margin-bottom:16px;}
    header img{width:32px;height:32px;border-radius:6px;}
    h1{font-size:22px;margin:0;letter-spacing:.3px;}
    nav{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin:12px 0 20px;}
    nav button{background:var(--panel);color:var(--fg);border:1px solid #25406d;border-radius:10px;padding:12px;font-weight:600;cursor:pointer;}
    nav button.active{outline:2px solid var(--ring);}
    section.panel{background:rgba(15,35,66,.66);border:1px solid #25406d;border-radius:14px;padding:16px;display:none;box-shadow:0 10px 30px rgba(0,0,0,.25), inset 0 0 40px rgba(255,255,255,.02);}
    section.panel.active{display:block;}
    .card{background:rgba(20,44,84,.7);border:1px solid #2b4b82;border-radius:14px;padding:14px;margin:12px 0;}
    .muted{color:var(--muted);} .accent{color:var(--accent);font-weight:700;}
    .cta{display:inline-block;padding:12px 16px;background:#193b74;border:1px solid #2b4b82;border-radius:10px;color:var(--fg);font-weight:700;cursor:pointer;}
    .center{text-align:center;}
    .breath-circle{width:180px;height:180px;border-radius:50%;margin:16px auto;background:radial-gradient(closest-side,#21447e,#152b52);display:grid;place-items:center;border:2px solid #2b4b82;transition:transform 1s ease-in-out;}
    .breath-text{font-size:18px;}
    .row{display:flex;gap:10px;align-items:center;justify-content:center;flex-wrap:wrap;}
    textarea{width:100%;min-height:180px;padding:12px;border-radius:12px;border:1px solid #2b4b82;background:#0f2342;color:var(--fg);}
    .small{font-size:12px;opacity:.9;} footer{margin-top:24px;opacity:.8;font-size:12px;text-align:center;}

    /* chips (se existirem) */
    .chip{padding:8px 12px;border-radius:999px;border:1px solid #2b4b82;background:#142c54;color:var(--fg);font-weight:600;cursor:pointer}
    .chip.active{outline:2px solid var(--ring)}

    /* Rodap√© Or√°culo com safe area e z-index alto */
    .footer-oraculo{
      position:fixed;left:0;right:0;bottom:0;
      padding:10px 16px calc(10px + env(safe-area-inset-bottom));
      background:radial-gradient(800px 300px at 50% 130%, #1a3564, #0a1628);
      border-top:1px solid #25406d;display:flex;justify-content:center;
      box-shadow:0 -10px 30px rgba(0,0,0,.25);
      z-index:9999;
    }
    .btn-oraculo{display:inline-flex;align-items:center;gap:10px;padding:12px 18px;background:#193b74;border:1px solid #2b4b82;border-radius:12px;color:var(--fg);font-weight:800;letter-spacing:.3px;text-decoration:none;}
    .btn-oraculo:active{transform:scale(.98);}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="assets/icon-192.png?v=8" alt="√çcone">
      <div>
        <h1>Entre Mundos ‚Äî Dia 1</h1>
        <div class="small muted">Mensagem ‚Ä¢ Respira√ß√£o ‚Ä¢ Frase ‚Ä¢ Sil√™ncio</div>
      </div>
    </header>

    <nav>
      <button id="tab-guia" class="active">Guia Espiritual</button>
      <button id="tab-silencio">Sil√™ncio</button>
      <button id="tab-escrita">Escrita da Alma</button>
    </nav>

    <section id="guia" class="panel active">
      <div class="card">
        <div class="muted">Mensagem de hoje ‚Äî <span class="accent">Reconex√£o</span></div>
        <p>Respira e lembra-te: <span class="accent">tu √©s a casa antes do mundo</span>. O teu valor n√£o depende da produtividade; a tua verdade n√£o precisa gritar. A cor azul √© o teu porto ‚Äî volta a ela quando o ru√≠do te cansar.</p>
      </div>

      <div class="card center">
        <div class="muted">Pr√°tica ‚Äî Respira√ß√£o em 4 tempos (4‚Ä¢4‚Ä¢4‚Ä¢4)</div>
        <div id="circle" class="breath-circle"><div class="breath-text" id="breath-text">Preparar‚Ä¶</div></div>
        <div class="row">
          <button class="cta" id="start-breath">Come√ßar</button>
          <button class="cta" id="stop-breath">Parar</button>
        </div>
        <div class="small muted" style="margin-top:8px">Inspira 4 ‚Ä¢ Sustenha 4 ‚Ä¢ Expira 4 ‚Ä¢ Pausa 4</div>
      </div>

      <div class="card center">
        <div class="muted">Frase √¢ncora</div>
        <p class="accent">‚ÄúEu volto. Eu volto. Eu volto.‚Äù</p>
      </div>
    </section>

    <section id="silencio" class="panel">
      <div class="card center">
        <div class="muted">Momento de sil√™ncio</div>
        <p>Define o tempo e toca em <b>Iniciar</b>. Fica contigo, s√≥ a respirar.</p>
        <div class="row" style="margin-bottom:8px; gap:8px; flex-wrap:wrap">
          <button class="chip dur-btn" data-mins="1">1 min</button>
          <button class="chip dur-btn" data-mins="2">2 min</button>
          <button class="chip dur-btn" data-mins="3">3 min</button>
          <button class="chip dur-btn" data-mins="5">5 min</button>
          <label style="margin-left:8px">
            <span class="small muted">ou</span>
            <input id="minutes" type="number" min="1" max="30" value="1" style="width:80px">
          </label>
        </div>
        <div class="row" style="margin-bottom:8px">
          <button class="cta" id="start-timer">Iniciar</button>
          <button class="cta" id="stop-timer">Parar</button>
        </div>
        <div id="timer" class="accent" style="font-size:28px">01:00</div>
      </div>
    </section>

    <section id="escrita" class="panel">
      <div class="card">
        <div class="muted">Escrita da Alma (fica guardado no teu dispositivo)</div>
        <p class="small">Sugest√µes: ‚ÄúAgora, o que d√≥i √©‚Ä¶‚Äù, ‚ÄúO que ainda me prende √©‚Ä¶‚Äù, ‚ÄúO que me alivia √©‚Ä¶‚Äù</p>
        <textarea id="journal" placeholder="Escreve aqui. S√≥ tu l√™s."></textarea>
        <div class="row" style="justify-content: space-between; margin-top:8px">
          <span class="small muted" id="count">0 caracteres</span>
          <button class="cta" id="save">Guardar</button>
        </div>
        <div class="small" id="status" style="margin-top:6px"></div>
      </div>
    </section>

    <footer>Entre Mundos ‚Äî Dia 1 ‚Ä¢ feito com verdade ü©µ</footer>
  </div>

  <!-- Bot√£o fixo do Or√°culo -->
  <div class="footer-oraculo">
    <a class="btn-oraculo" href="oraculo.html?v=9">üîÆ Or√°culo</a>
  </div>

<script>
  // Tabs
  const tabs = {guia:document.getElementById('guia'), silencio:document.getElementById('silencio'), escrita:document.getElementById('escrita')};
  function activate(id){ for(const [k,el] of Object.entries(tabs)){ el.classList.toggle('active', k===id); document.getElementById('tab-'+k).classList.toggle('active', k===id);}}
  document.getElementById('tab-guia').onclick=()=>activate('guia');
  document.getElementById('tab-silencio').onclick=()=>activate('silencio');
  document.getElementById('tab-escrita').onclick=()=>activate('escrita');

  // Respira√ß√£o suave
  let breathTimer=null, phase=0; const phases=['Inspira','Sustenha','Expira','Pausa'];
  const circle=document.getElementById('circle'), btxt=document.getElementById('breath-text');
  function stepPhase(){ const p=phases[phase%4]; if(btxt) btxt.textContent=p; const target=(p==='Inspira')?1.2:(p==='Expira'?0.9:1.05); const start=performance.now(); const dur=750; function anim(t){ const k=Math.min(1,(t-start)/dur); const s=1+(target-1)*k; if(circle) circle.style.transform=`scale(${s})`; if(k<1) requestAnimationFrame(anim);} requestAnimationFrame(anim); phase++; }
  document.getElementById('start-breath')?.addEventListener('click', ()=>{ if(breathTimer) return; phase=0; stepPhase(); breathTimer=setInterval(stepPhase,4000); });
  document.getElementById('stop-breath')?.addEventListener('click', ()=>{ clearInterval(breathTimer); breathTimer=null; if(btxt) btxt.textContent='Pausa'; if(circle) circle.style.transform='scale(1)'; });

  // Sil√™ncio com presets 1/2/3/5 + lembrar √∫ltima
  const timerEl=document.getElementById('timer');
  const minutesInput=document.getElementById('minutes');
  const durBtns=[...document.querySelectorAll('.dur-btn')];
  function fmt(s){const m=Math.floor(s/60),r=s%60;return String(m).padStart(2,'0')+':'+String(r).padStart(2,'0');}
  function setActive(mins){
    durBtns.forEach(b=>b.classList.toggle('active', Number(b.dataset.mins)===mins));
    if (minutesInput) minutesInput.value = String(mins);
    localStorage.setItem('entre-mundos-dia1-silencio-mins', String(mins));
  }
  let tInt=null,left=60;
  function tick(){ left--; if(left<=0){ clearInterval(tInt); tInt=null; left=0; } timerEl.textContent = fmt(left); }
  document.getElementById('start-timer').onclick=()=>{
    const mins = Math.max(1, Math.min(30, parseInt(minutesInput.value||'1',10)));
    left = mins*60; timerEl.textContent = fmt(left);
    clearInterval(tInt); tInt = setInterval(tick,1000);
    setActive(mins);
  };
  document.getElementById('stop-timer').onclick=()=>{ clearInterval(tInt); tInt=null; };
  durBtns.forEach(b=>b.onclick=()=> setActive(Number(b.dataset.mins)));
  const savedMins = parseInt(localStorage.getItem('entre-mundos-dia1-silencio-mins')||'1',10);
  setActive(savedMins); timerEl.textContent = fmt(savedMins*60);

  // Escrita
  const area=document.getElementById('journal'), count=document.getElementById('count'), status=document.getElementById('status');
  function update(){ count.textContent = (area.value.length) + ' caracteres'; }
  area.addEventListener('input', update);
  document.getElementById('save').onclick = () => {
    localStorage.setItem('entre-mundos-dia1-journal', area.value);
    status.textContent = 'Guardado no teu dispositivo.';
    setTimeout(() => status.textContent = '', 2000);
  };
  const savedJournal = localStorage.getItem('entre-mundos-dia1-journal');
  if (savedJournal) { area.value = savedJournal; update(); }

  // PWA
  if ('serviceWorker' in navigator) { window.addEventListener('load', () => { navigator.serviceWorker.register('./sw.js'); }); }
</script>
</body>
</html>
