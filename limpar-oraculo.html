<!doctype html>
<html lang="pt-PT">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Limpar Oráculo — Remover Números</title>
  <style>
    body{font-family:-apple-system,system-ui,Segoe UI,Roboto,Helvetica,Arial;background:#0a1628;color:#e9f0ff;margin:0;padding:24px}
    .panel{max-width:760px;margin:0 auto;background:rgba(15,35,66,.66);border:1px solid #25406d;border-radius:14px;padding:16px}
    button{background:#193b74;border:1px solid #2b4b82;border-radius:10px;color:#e9f0ff;font-weight:800;padding:12px 14px;cursor:pointer}
    .muted{color:#9db3ff}
    pre{white-space:pre-wrap;background:#0f2342;border:1px solid #2b4b82;border-radius:12px;padding:12px}
  </style>
</head>
<body>
  <div class="panel">
    <h2>Limpar Oráculo — remover números no fim das frases</h2>
    <p class="muted">Esta ferramenta carrega o <code>oraculo.json</code> atual, remove sufixos como <code>(94)</code>, e oferece o download do ficheiro limpo.</p>
    <button id="run">Limpar e descarregar JSON</button>
    <div id="res" class="muted" style="margin-top:12px"></div>
    <pre id="preview" style="display:none"></pre>
  </div>

<script>
function normalize(data){
  if (Array.isArray(data)) return data;
  if (data && Array.isArray(data.mensagens)) return data.mensagens;
  if (data && Array.isArray(data.messages)) return data.messages;
  return [];
}
function cleanTailNumber(s){ return (s||'').replace(/\s*\(\s*\d+\s*\)\s*$/, '').trim(); }

document.getElementById('run').addEventListener('click', async () => {
  const resEl = document.getElementById('res');
  const preEl = document.getElementById('preview');
  resEl.textContent = 'A carregar oraculo.json…';
  try{
    const resp = await fetch('oraculo.json?ts='+Date.now(), {cache:'no-store'});
    const data = await resp.json();
    const arr = normalize(data).map(cleanTailNumber).filter(Boolean);
    const out = { mensagens: arr };
    const txt = JSON.stringify(out, null, 2);
    preEl.style.display = 'block';
    preEl.textContent = txt.slice(0, 2000) + (txt.length>2000 ? '\n…' : '');
    resEl.textContent = 'Limpas '+arr.length+' mensagens. A descarregar…';
    const blob = new Blob([txt], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'oraculo.json';
    a.click();
    URL.revokeObjectURL(a.href);
  }catch(e){
    resEl.textContent = 'Erro a carregar/limpar o JSON.';
  }
});
</script>
</body>
</html>
